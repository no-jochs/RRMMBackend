#!/usr/bin/env ruby
require 'fileutils'

web_client_build_path = ENV["WEB_CLIENT_BUILD_PATH"] || File.absolute_path(Rails.root, "web_client", "build")
rails_meeting_finder_index_path = ENV["RAILS_MEETING_FINDER_INDEX_PATH"] || File.absolute_path(Rails.root,"app","views","meeting_finder")
rails_client_build_public_assets_path = ENV["RAILS_CLIENT_BUILD_PUBLIC_ASSETS_PATH"] || File.absolute_path(Rails.root, "public")

unless Dir.exists?(web_client_build_path)
  raise LoadError, "No directory located at #{web_client_build_path}."
end

unless Dir.exists?(rails_meeting_finder_index_path)
  raise LoadError, "No directory located at #{rails_meeting_finder_index_path}."
end

# Copy over the index.html file

Dir[web_client_build_path].each do |entry|
  ap_entry = File.join(web_client_build_path, entry)

  if File.file?(ap_entry) && entry == "index.html"
    puts "Copying: #{ap_entry} -> #{File.join(rails_meeting_finder_index_path, entry)}"
    FileUtils.copy_file(ap_entry, File.join(rails_meeting_finder_index_path, entry), remove_destination: true)
  else
    puts "Copying: #{ap_entry} -> #{File.join(web_client_build_path, entry)}"
    FileUtils.copy_entry(ap_entry, File.join(rails_client_build_public_assets_path, entry),remove_destination: true)
  end
end

puts "Finished copying client build files!"